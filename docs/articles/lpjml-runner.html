<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LPJmL Runner ‚Ä¢ lpjmlkit</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="LPJmL Runner">
<meta property="og:description" content="lpjmlkit">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lpjmlkit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lpjml-data.html">LPJmL Data</a>
    </li>
    <li>
      <a href="../articles/lpjml-runner.html">LPJmL Runner</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/PIK-LPJmL/lpjmlkit/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>LPJmL Runner</h1>
                        <h4 data-toc-skip class="author">Jannes
Breier</h4>
            
            <h4 data-toc-skip class="date">2024-07-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/PIK-LPJmL/lpjmlkit/blob/HEAD/vignettes/lpjml-runner.Rmd" class="external-link"><code>vignettes/lpjml-runner.Rmd</code></a></small>
      <div class="hidden name"><code>lpjml-runner.Rmd</code></div>

    </div>

    
    
<p><strong>LPJmL Runner</strong> üèÉ is a lpjmlkit module of functions
that have the goal to simplify the execution of simulations with LPJmL
and further to execute complex, nested and multiple simulation sequences
fast and less error prone without having a big (bash) script
overhead.<br>
To install LPJmL, read the <a href="https://github.com/PIK-LPJmL/LPJmL/blob/master/INSTALL" class="external-link">LPJmL
installation instructions</a>. </p>
<div class="section level2">
<h2 id="setup">‚öô Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p><strong>! Important !</strong> The LPJmL Runner module only supports
unix-based operating systems in which the <a href="https://github.com/PIK-LPJmL/LPJmL/blob/master/INSTALL" class="external-link">working
environment for LPJmL</a> is configured!<br>
For users on the PIK cluster: Load the <code>"lpjml"</code> module or
add it to your <code>".profile"</code>. ¬†</p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The LPJmL Runner generally requires 3 to 4 working steps: Define a
modified parameter table (1), create the corresponding configuration
files (2), check if the these are valid for LPJmL (3 - optional) and run
or submit LPJmL with each configurations (4).</p>
<div class="section level4">
<h4 id="define-a-table-of-modified-configuration-parameters">
<strong>1. üìã Define a table of modified configuration
parameters</strong><br><a class="anchor" aria-label="anchor" href="#define-a-table-of-modified-configuration-parameters"></a>
</h4>
<p><br>
Define what LPJmL configurations/parameters to be changed. Please
familiarize yourself with available configuration options.<br>
The base configuration file (e.g.‚Äùlpjml_config.cjson‚Äù) can be read in
via <code>read_config</code> as a nested list object. Using the same
syntax configurations/parameters can be changed directly in the
corresponding configuration file or in a data frame (see example).<br><code><a href="../reference/write_config.html">?write_config</a></code> <em>for more information.</em></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  sim_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scenario1"</span>, <span class="st">"scenario2"</span><span class="op">)</span>,</span>
<span>  random_seed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">404</span><span class="op">)</span>,</span>
<span>  `param$k_temp` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.03</span><span class="op">)</span>,</span>
<span>  new_phenology <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
</div>
<div class="section level4">
<h4 id="create-corresponding-configuration-files">
<strong>2. ‚úç Create corresponding Configuration files</strong><br><a class="anchor" aria-label="anchor" href="#create-corresponding-configuration-files"></a>
</h4>
<p><br>
Now the central function is <code>write_config</code>, create and write
LPJmL Configuration (config) file(s) <code>"config_*.json"</code> from a
data frame with the parameters of a base config file
<code>"lpjml_config.cjson"</code> to be changed.
<code><a href="../reference/write_config.html">?write_config</a></code> <em>for more information.</em></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">config_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_config.html">write_config</a></span><span class="op">(</span><span class="va">my_params</span>, <span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="check-validity-of-configurations">
<strong>3. üîç Check validity of Configurations</strong><br><a class="anchor" aria-label="anchor" href="#check-validity-of-configurations"></a>
</h4>
<p><br>
Check whether your config(s) are valid for LPJmL by passing the returned
data frame to <code>check_lpjml</code>. It won‚Äôt raise an error
(dependencies might not be satisfied yet) but will print/return the
information of <code>lpjcheck</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lpjml_check</span><span class="op">(</span><span class="va">config_details</span>, <span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="run-or-submit-lpjml">
<strong>4. ‚ñ∂ Run or üöÄ submit LPJmL</strong><br><a class="anchor" aria-label="anchor" href="#run-or-submit-lpjml"></a>
</h4>
<p><br>
Run LPJmL for each Configuration locally via <code>run_lpjml</code> or
submit as a batch job to SLURM (PIK Cluster) via
<code>submit_lpjml</code>. <code>run_lpjml</code> can also be utilized
within slurm jobs to execute multiple single cell runs.<br><code><a href="../reference/submit_lpjml.html">?submit_lpjml</a></code> <em>or</em> <code><a href="../reference/run_lpjml.html">?run_lpjml</a></code> <em>for
more information.</em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run interactively</span></span>
<span><span class="va">run_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_lpjml.html">run_lpjml</a></span><span class="op">(</span><span class="va">config_details</span>, <span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span>
<span><span class="co"># OR submit to SLURM</span></span>
<span><span class="va">submit_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_lpjml.html">submit_lpjml</a></span><span class="op">(</span><span class="va">config_details</span>, <span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="miscellaneous">
<strong>miscellaneous</strong><br><a class="anchor" aria-label="anchor" href="#miscellaneous"></a>
</h4>
<p><br>
More helpful functions that come with LPJmL Runner are:</p>
<ul>
<li><p><code>read_config</code> to read a configuration file as a nested
R list object</p></li>
<li><p>use the R internal <code>View</code> function for a tree
visualization of a <code>"config_*.json"</code> file</p></li>
<li><p><code>make_lpjml</code> function for compiling LPJmL.</p></li>
</ul>
<p>¬† ¬†</p>
</div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/PIK-LPJmL/lpjmlkit" class="external-link">lpjmlkit</a></span><span class="op">)</span></span>
<span><span class="co"># Why tibble? -&gt; https://r4ds.had.co.nz/tibbles.html</span></span>
<span><span class="co"># Tibbles also provide a better overview of the data and directly show the type</span></span>
<span><span class="co"># of each column, which is very important for integer/floating point values.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_path</span> <span class="op">&lt;-</span> <span class="st">"./LPJmL_internal"</span></span>
<span><span class="va">sim_path</span> <span class="op">&lt;-</span> <span class="st">"./my_runs"</span></span></code></pre></div>
<p>¬† ¬†</p>
<div style="page-break-after: always;"></div>
<div class="section level3">
<h3 id="single-cell-simulations">Single cell simulations<br><a class="anchor" aria-label="anchor" href="#single-cell-simulations"></a>
</h3>
<p>Single cell (or short number of multiple cells) simulations can be
executed locally or on a login node. This mode is especially useful when
it comes to testing or comparing local data.</p>
<div class="section level4">
<h4 id="example-potential-natural-vegetation-and-land-use-run">
<strong>Example</strong> <em>Potential natural vegetation and
land-use run</em><a class="anchor" aria-label="anchor" href="#example-potential-natural-vegetation-and-land-use-run"></a>
</h4>
<p>¬†</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create parameter tibble</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  sim_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spinup"</span>, <span class="st">"lu"</span>, <span class="st">"pnv"</span><span class="op">)</span>,</span>
<span>  landuse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no"</span>, <span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span>,</span>
<span>  <span class="co"># only for demonstration</span></span>
<span>  nspinup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  reservoir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  startgrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">27410</span>, <span class="fl">27410</span>, <span class="fl">27410</span><span class="op">)</span>,</span>
<span>  river_routing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  wateruse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no"</span>, <span class="st">"yes"</span>, <span class="st">"no"</span><span class="op">)</span>,</span>
<span>  const_deposition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="co"># run parameter: dependency sets the restart paths to the corresponding</span></span>
<span>  <span class="co">#   restart_filename and calculates the execution order</span></span>
<span>  dependency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="cn">NA</span>, <span class="st">"spinup"</span>, <span class="st">"spinup"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write config files</span></span>
<span><span class="va">config_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_config.html">write_config</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">params</span>, <span class="co"># pass the defined parameter tibble</span></span>
<span>  model_path <span class="op">=</span> <span class="va">model_path</span>,</span>
<span>  sim_path <span class="op">=</span> <span class="va">sim_path</span>,</span>
<span>  js_filename <span class="op">=</span> <span class="st">"lpjml_config.cjson"</span> <span class="co"># (default) the base config file</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read and view config</span></span>
<span><span class="va">config_lu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_config.html">read_config</a></span><span class="op">(</span></span>
<span>  filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sim_path</span>, <span class="st">"/configurations/config_lu.json"</span><span class="op">)</span> <span class="co"># nolint:absolute_path_linter.</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">config_lu</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check config &amp; LPJmL</span></span>
<span><span class="fu"><a href="../reference/check_config.html">check_config</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">config_details</span>, <span class="co"># can be filename (vector) or tibble</span></span>
<span>  model_path <span class="op">=</span> <span class="va">model_path</span>,</span>
<span>  sim_path <span class="op">=</span> <span class="va">sim_path</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># execute runs sequentially</span></span>
<span><span class="va">run_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_lpjml.html">run_lpjml</a></span><span class="op">(</span></span>
<span>  <span class="va">config_details</span>,</span>
<span>  model_path <span class="op">=</span> <span class="va">model_path</span>,</span>
<span>  sim_path <span class="op">=</span> <span class="va">sim_path</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="example-old-vs--new-phenology-and-old-land-use-vs--input-toolbox">
<strong>Example</strong> <em>Old vs.¬†new phenology and old land-use
vs.¬†input toolbox</em><a class="anchor" aria-label="anchor" href="#example-old-vs--new-phenology-and-old-land-use-vs--input-toolbox"></a>
</h4>
<p>¬†</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create parameter tibble</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  sim_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spinup_oldphen"</span>,</span>
<span>               <span class="st">"spinup_newphen"</span>,</span>
<span>               <span class="st">"oldphen"</span>,</span>
<span>               <span class="st">"old_lu"</span>,</span>
<span>               <span class="st">"lu_toolbox"</span><span class="op">)</span>,</span>
<span>  <span class="co"># object oriented like syntax to access nested json elements</span></span>
<span>  `input$landuse$name` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="cn">NA</span>,</span>
<span>    <span class="cn">NA</span>,</span>
<span>    <span class="cn">NA</span>,</span>
<span>    <span class="cn">NA</span>,</span>
<span>    <span class="st">"input_toolbox_30arcmin/cftfrac_1500-2017_64bands_f2o.clm"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nspinup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1000</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  new_phenology <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  startgrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">27410</span>, <span class="fl">27410</span>, <span class="fl">27410</span>, <span class="fl">27410</span>, <span class="fl">27410</span><span class="op">)</span>,</span>
<span>  river_routing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  dependency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"spinup_oldphen"</span>, <span class="st">"spinup_newphen"</span>, <span class="st">"spinup_newphen"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write config files</span></span>
<span><span class="va">config_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_config.html">write_config</a></span><span class="op">(</span><span class="va">params</span>, <span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check config &amp; LPJmL</span></span>
<span><span class="fu"><a href="../reference/check_config.html">check_config</a></span><span class="op">(</span><span class="va">config_details</span>, <span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># execute runs sequentially</span></span>
<span><span class="va">run_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_lpjml.html">run_lpjml</a></span><span class="op">(</span><span class="va">config_details</span>, <span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span></code></pre></div>
<p>¬† ¬† ¬†</p>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="section level3">
<h3 id="global-simulations-on-the-pik-cluster">Global simulations on the PIK cluster<a class="anchor" aria-label="anchor" href="#global-simulations-on-the-pik-cluster"></a>
</h3>
<p>Global simulations are simulations on all available cells with a
coherent water cycle. It requires more computational ressources which is
why they have to be run at dedicated compute nodes, at PIK Cluster only
accessible via SLURM Job scheduler. Therefore LPJmL has to be
‚Äúsubmitted‚Äù.</p>
<div class="section level4">
<h4 id="example-compare-old-vs-new-land-use-lpjml-input-toolbox">
<strong>Example</strong> <em>Compare old vs new land use (lpjml
input toolbox)</em><a class="anchor" aria-label="anchor" href="#example-compare-old-vs-new-land-use-lpjml-input-toolbox"></a>
</h4>
<p>¬†</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create parameter tibble</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  sim_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spinup"</span>,</span>
<span>               <span class="st">"old_lu"</span>,</span>
<span>               <span class="st">"lu_toolbox"</span><span class="op">)</span>,</span>
<span>  `input$landuse$name` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="cn">NA</span>,</span>
<span>    <span class="cn">NA</span>,</span>
<span>    <span class="st">"input_toolbox_30arcmin/cftfrac_1500-2017_64bands_f2o.clm"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  dependency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"spinup"</span>, <span class="st">"spinup"</span><span class="op">)</span>,</span>
<span>  <span class="co"># slurm option wtime: analogous to sbatch -wtime defines slurm option</span></span>
<span>  <span class="co">#   individually per config, overwrites submit_lpjml argument</span></span>
<span>  <span class="co">#   (same for sclass, ntasks, blocking or constraint)</span></span>
<span>  wtime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"15:00:00"</span>, <span class="st">"3:00:00"</span>, <span class="st">"3:00:00"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write config files</span></span>
<span><span class="va">config_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_config.html">write_config</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">params</span>,</span>
<span>  model_path <span class="op">=</span> <span class="va">model_path</span>,</span>
<span>  sim_path <span class="op">=</span> <span class="va">sim_path</span>,</span>
<span>  output_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vegc"</span>, <span class="st">"soilc"</span>, <span class="st">"cftfrac"</span>, <span class="st">"pft_harvestc"</span>, <span class="st">"irrig"</span><span class="op">)</span>,</span>
<span>  output_list_timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"annual"</span>, <span class="st">"annual"</span>, <span class="st">"annual"</span>, <span class="st">"annual"</span>, <span class="st">"monthly"</span><span class="op">)</span>,</span>
<span>  output_format <span class="op">=</span> <span class="st">"clm"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check config &amp; LPJmL</span></span>
<span><span class="fu"><a href="../reference/check_config.html">check_config</a></span><span class="op">(</span><span class="va">config_details</span>, <span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># submit runs to slurm</span></span>
<span><span class="va">run_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_lpjml.html">submit_lpjml</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">config_details</span>,</span>
<span>  model_path <span class="op">=</span> <span class="va">model_path</span>,</span>
<span>  sim_path <span class="op">=</span> <span class="va">sim_path</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"open"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>¬† ¬†</p>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="section level3">
<h3 id="notes-tips">Notes &amp; tips<a class="anchor" aria-label="anchor" href="#notes-tips"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p>You can save the generated config tibble by applying
<code>saveRDS</code> to it to reuse for a rerun or resubmission next
time ‚Ä¶</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">config_details</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sim_path</span>, <span class="st">"/configurations/config_details.rds"</span><span class="op">)</span><span class="op">)</span> <span class="co"># nolint:absolute_path_linter.</span></span>
<span><span class="co"># next time ...</span></span>
<span><span class="va">config_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sim_path</span>, <span class="st">"/configurations/config_details.rds"</span><span class="op">)</span> <span class="co"># nolint:absolute_path_linter.</span></span>
<span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p>Also if you want do not want to submit all runs you can ‚Ä¶</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use a subset for the rows - in this example you may only want to resubmit the</span></span>
<span><span class="co">#   transient runs</span></span>
<span><span class="va">run_details</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_lpjml.html">submit_lpjml</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">config_details</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span>,</span>
<span>  model_path <span class="op">=</span> <span class="va">model_path</span>,</span>
<span>  sim_path <span class="op">=</span> <span class="va">sim_path</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"open"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</li>
<li><p><em>a bit dirty though</em> If you want to reuse an old spinup
simulation, you can copy the file or create a symlink of the file to
<code>"&lt;sim_path&gt;/restart/&lt;spinup_sim_name&gt;/restart.lpj"</code>.
Make sure the file/symlink is named <code>"restart.lpj"</code></p></li>
</ol>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jannes Breier, Sebastian Ostberg, Stephen Bj√∂rn Wirth, Sara Minoli, Fabian Stenzel, Christoph M√ºller.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
