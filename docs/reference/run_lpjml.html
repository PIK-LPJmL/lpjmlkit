<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Run LPJmL model — run_lpjml • lpjmlkit</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Run LPJmL model — run_lpjml"><meta property="og:description" content='Runs LPJmL using "config_*.json" files written by
write_config(). write_config() returns a tibble
that can be used as an input (see x). It contains the details to run single
or multiple (dependent/subsequent) model runs.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lpjmlkit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/lpjml-data.html">LPJmL Data</a>
    </li>
    <li>
      <a href="../articles/lpjml-runner.html">LPJmL Runner</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/PIK-LPJmL/lpjmlkit/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Run LPJmL model</h1>
    <small class="dont-index">Source: <a href="https://github.com/PIK-LPJmL/lpjmlkit/blob/HEAD/R/run_lpjml.R" class="external-link"><code>R/run_lpjml.R</code></a></small>
    <div class="hidden name"><code>run_lpjml.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Runs LPJmL using <code>"config_*.json"</code> files written by
<code><a href="write_config.html">write_config()</a></code>. <code><a href="write_config.html">write_config()</a></code> returns a tibble
that can be used as an input (see <code>x</code>). It contains the details to run single
or multiple (dependent/subsequent) model runs.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">run_lpjml</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  model_path <span class="op">=</span> <span class="st">"."</span>,</span>
<span>  sim_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  run_cmd <span class="op">=</span> <span class="st">"srun --propagate"</span>,</span>
<span>  parallel_cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  write_stdout <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  raise_error <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  output_path <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>A <a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a> with at least one column named <code>"sim_name"</code>.
Each simulation gets a separate row. Optional run parameters are <code>"order"</code>
and <code>"dependency"</code> which are used for subsequent simulations (see details).
<code><a href="write_config.html">write_config()</a></code> returns a tibble in the required format.
OR provide a character string (vector) with the file name of one or
multiple generated configuration file(s).</p></dd>


<dt>model_path</dt>
<dd><p>Character string providing the path to LPJmL
(equal to <code>LPJROOT</code> environment variable). Defaults to "."</p></dd>


<dt>sim_path</dt>
<dd><p>Character string defining path where all simulation data are
written, including output, restart and configuration files. If <code>NULL</code>,
<code>model_path</code> is used. See also <a href="write_config.html">write_config</a></p></dd>


<dt>run_cmd</dt>
<dd><p>Character string defining the command used to execute lpjml
(see details). Defaults to "srun --propagate" (compute ondes of old cluster
at PIK). Change to "mpirun" for HPC2024 at PIK.</p></dd>


<dt>parallel_cores</dt>
<dd><p>Integer defining the number of available CPU
cores/nodes for parallelization. Defaults to <code>1</code> (no parallelization).
Please note that parallelization is only supported for SLURM jobs and not
for interactive runs.</p></dd>


<dt>write_stdout</dt>
<dd><p>Logical. If <code>TRUE</code>, <code>stdout</code> as well as <code>stderr</code> files
are written. If <code>FALSE</code> (default), these are printed instead. Within a
SLURM job <code>write_stdout</code> is automatically set to <code>TRUE</code>.</p></dd>


<dt>raise_error</dt>
<dd><p>Logical. Whether to raise an error if sub-process has
non-zero exit status. Defaults to <code>TRUE</code>.</p></dd>


<dt>output_path</dt>
<dd><p>Argument is deprecated as of version 1.0; use sim_path
instead.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>See <code>x</code>, extended by columns <code>"type"</code>, <code>"job_id"</code> and <code>"status"</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p><b>x</b>:
A <a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a> for <code>x</code> that has been generated by
<code><a href="write_config.html">write_config()</a></code> and can look like the following examples can
supplied:</p><table class="table table"><tr><td><strong>sim_name</strong></td></tr><tr><td>scen1_spinup</td></tr><tr><td>scen2_transient</td></tr><tr><td></td></tr></table><p>To perform subsequent or rather dependent runs the optional run parameter
<code>"dependency"</code> needs to be provided within the initial
<a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a> supplied as <code>param</code> to <code><a href="write_config.html">write_config()</a></code>.</p><table class="table table"><tr><td><strong>sim_name</strong></td><td><strong>order</strong></td><td><strong>dependency</strong></td></tr><tr><td>scen1_spinup</td><td>1</td><td>NA</td></tr><tr><td>scen2_transient</td><td>2</td><td>scen1 _spinup</td></tr></table><p>As a shortcut it is also possible to provide the config file
<code>"config_*.json"</code> as a character string or multiple config files as a
character string vector directly as the <code>x</code> argument to <code>run_lpjml</code>. <br>
Also be aware that the order of the supplied config files is important
(e.g. make sure the spin-up run is run before the transient one).</p>
<p><b>run_cmd</b>:
The <code>run_cmd</code> argument is used to define the command to execute LPJmL. This
is needed because the LPJmL executable can not directly be used on all
machines. Which command has to be used depends on the software installed.
Further information on this can be found in the INSTALL file of LPJmL.
To determine the correct command, check the lpj_submit.sh file in the bin
directory of LPJmL. Using PIK infrastrucure the command is <code>srun</code> for
the hpc2015 and <code>mpirun</code> for the hpc2024. To facilitate usage on the
interactive (login) nodes, no command is needed for hpc2015. For the hpc2024
the command remains <code>mpirun</code> (in these cases <code>run_lpjml</code> adjusts
<code>run_cmd</code> accordingly).</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">model_path</span> <span class="op">&lt;-</span> <span class="st">"./LPJmL_internal"</span></span></span>
<span class="r-in"><span><span class="va">sim_path</span> <span class="op">&lt;-</span><span class="st">"./my_runs"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Basic usage</span></span></span>
<span class="r-in"><span><span class="va">my_params1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  sim_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scen1"</span>, <span class="st">"scen2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  startgrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">27410</span>, <span class="fl">27410</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  river_routing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  random_seed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">404</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  `pftpar[[1]]$name` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"first_tree"</span>, <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  `param$k_temp` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.03</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  new_phenology <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">config_details1</span> <span class="op">&lt;-</span> <span class="fu"><a href="write_config.html">write_config</a></span><span class="op">(</span><span class="va">my_params1</span>, <span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="va">run_details1</span> <span class="op">&lt;-</span> <span class="fu">run_lpjml</span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="va">config_details1</span>,</span></span>
<span class="r-in"><span>  model_path <span class="op">=</span> <span class="va">model_path</span>,</span></span>
<span class="r-in"><span>  sim_path <span class="op">=</span> <span class="va">sim_path</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">run_details1</span></span></span>
<span class="r-in"><span><span class="co">#   sim_name      job_id   status</span></span></span>
<span class="r-in"><span><span class="co">#   &lt;chr&gt;           &lt;int&gt;  &lt;chr&gt;</span></span></span>
<span class="r-in"><span><span class="co"># 1 scen1              NA  run</span></span></span>
<span class="r-in"><span><span class="co"># 2 scen2              NA  run</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With run parameters dependency and order being set (also less other</span></span></span>
<span class="r-in"><span><span class="co">#   parameters than in previous example)</span></span></span>
<span class="r-in"><span><span class="va">my_params2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  sim_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scen1"</span>, <span class="st">"scen2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  startgrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">27410</span>, <span class="fl">27410</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  river_routing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  random_seed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">42</span>, <span class="fl">404</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  dependency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"scen1_spinup"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">config_details2</span> <span class="op">&lt;-</span> <span class="fu"><a href="write_config.html">write_config</a></span><span class="op">(</span><span class="va">my_params2</span>, <span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">run_details2</span> <span class="op">&lt;-</span> <span class="fu">run_lpjml</span><span class="op">(</span><span class="va">config_details2</span>, <span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">run_details2</span></span></span>
<span class="r-in"><span><span class="co">#   sim_name        order dependency   type       job_id   status</span></span></span>
<span class="r-in"><span><span class="co">#   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;</span></span></span>
<span class="r-in"><span><span class="co"># 1 scen1_spinup        1 NA           simulation NA       run</span></span></span>
<span class="r-in"><span><span class="co"># 2 scen1_transient     2 scen1_spinup simulation NA       run</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Same but by using the pipe operator</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">run_details2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  sim_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"scen1_spinup"</span>, <span class="st">"scen1_transient"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  random_seed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">42</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  dependency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="st">"scen1_spinup"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="write_config.html">write_config</a></span><span class="op">(</span><span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">run_lpjml</span><span class="op">(</span><span class="va">model_path</span>, <span class="va">sim_path</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Shortcut approaches</span></span></span>
<span class="r-in"><span><span class="va">run_details3</span> <span class="op">&lt;-</span> <span class="fu">run_lpjml</span><span class="op">(</span></span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="st">"./config_scen1_transient.json"</span>,</span></span>
<span class="r-in"><span>  model_path <span class="op">=</span> <span class="va">model_path</span>,</span></span>
<span class="r-in"><span>  sim_path <span class="op">=</span> <span class="va">sim_path</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">run_details4</span> <span class="op">&lt;-</span> <span class="fu">run_lpjml</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"./config_scen1_spinup.json"</span>, <span class="st">"./config_scen1_transient.json"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="va">model_path</span>,</span></span>
<span class="r-in"><span>  <span class="va">sim_path</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Jannes Breier, Sebastian Ostberg, Stephen Björn Wirth, Sara Minoli, Fabian Stenzel, Christoph Müller.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

